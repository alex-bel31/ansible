# Тестирование roles
### Molecule

Для тестирования роли был инициализирован сценарий по умолчанию с драйвером Docker. В качестве тестовых платформ использовались образы `ubuntu-python:22.04` и `oraclelinux:8`.

Сценарий тестирования включал в себя:

* предварительную установку Python на целевых хостах (playbook `prepare.yml`);
* установку роли;
* проверку корректности установки и работы `vector`.

Проверки в `verify.yml` включали:

* наличие бинарника `vector`;
* валидацию конфигурации командой `vector validate`;
* проверку запущенного процесса `vector`;
* поиск ошибок в логах.

Были установлены зависимости для `molecule` в `requirements.txt`, включая `molecule-docker`, `ansible`, `ansible-compat`, `yamllint` и другие.

Также был собран собственный образ с необходимыми зависимостями, чтобы запускать тесты внутри контейнера.

В процессе были выявлены и устранены ошибки, связанные с отсутствием `sudo` и `python3` в базовых образах. Все проверки прошли успешно.

Результат зафиксирован в виде git-тега [`v1.1.0` ]()

### Tox

1. В директорию с ролью `vector-role` были добавлены необходимые файлы для сценария `molecule`.

2. Репозиторий был смонтирован в контейнер с образом `aragast/netology:latest` с помощью команды:

```bash
docker run --privileged=True -v ./:/opt/vector-role -w /opt/vector-role -it aragast/netology:latest /bin/bash
```
3. Внутри контейнера запущена команда `tox`. В процессе запуска выполнялся сценарий с драйвером `podman`.

     * Все этапы тестирования, включая `converge`, `verify` и `destroy`, успешно завершились.

4. В `verify.yml` были прописаны проверки:

    * наличие бинарника `vector`;
    * валидация конфигурации;
    
Итоговый сценарий отмечен тегом [`v1.2.0` ]()
